# Enable RewriteEngine
RewriteEngine On

# Set the base directory
RewriteBase /

# Prevent direct access to .php files (redirect to clean URL)
RewriteCond %{THE_REQUEST} \s/+(.+)\.php[\s?] [NC]
RewriteRule ^ /%1 [R=301,L]

# Block access to sensitive files
RewriteRule ^\.htaccess$ - [F]
RewriteRule ^composer\.(json|lock)$ - [F]
RewriteRule ^deploy\.php$ - [F]
RewriteRule ^config\.php$ - [F]
RewriteRule ^Dockerfile$ - [F]
RewriteRule ^docker-compose\.yml$ - [F]

# Clean URL rewrites for main pages
# /setsumei -> pages/setsumei.php
RewriteRule ^setsumei/?$ pages/setsumei.php [L]

# /dojoannai -> pages/dojoannai.php
RewriteRule ^dojoannai/?$ pages/dojoannai.php [L]

# /contact -> pages/contact.php
RewriteRule ^contact/?$ pages/contact.php [L]

# /access -> pages/access.php
RewriteRule ^access/?$ pages/access.php [L]

# /katsudokiroku -> pages/katsudokiroku.php
RewriteRule ^katsudokiroku/?$ pages/katsudokiroku.php [L]

# /yakuinshokai -> pages/yakuinshokai/index.php
RewriteRule ^yakuinshokai/?$ pages/yakuinshokai/index.php [L]

# /yakuinshokai/kaicho -> pages/yakuinshokai/kaicho.php
RewriteRule ^yakuinshokai/kaicho/?$ pages/yakuinshokai/kaicho.php [L]

# /yakuinshokai/fukukaicho -> pages/yakuinshokai/fukukaicho.php
RewriteRule ^yakuinshokai/fukukaicho/?$ pages/yakuinshokai/fukukaicho.php [L]

# /yakuinshokai/sodanyaku -> pages/yakuinshokai/sodanyaku.php
RewriteRule ^yakuinshokai/sodanyaku/?$ pages/yakuinshokai/sodanyaku.php [L]

# /yakuinshokai/shidosha -> pages/yakuinshokai/shidosha.php
RewriteRule ^yakuinshokai/shidosha/?$ pages/yakuinshokai/shidosha.php [L]

# Handle requests for files that don't exist
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+)$ $1.php [L]

# Security headers
<IfModule mod_headers.c>
    # Prevent MIME type sniffing
    Header set X-Content-Type-Options "nosniff"
    # Enable XSS protection
    Header set X-XSS-Protection "1; mode=block"
    # Prevent clickjacking
    Header set X-Frame-Options "SAMEORIGIN"
</IfModule>

# Disable directory listing
Options -Indexes

# Set default charset
AddDefaultCharset UTF-8

# PHP settings (if allowed by server)
<IfModule mod_php.c>
    php_flag display_errors Off
    php_flag expose_php Off
</IfModule>
